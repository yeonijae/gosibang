# SPEC-MED-001: 복약 기록 시스템 - 인수 조건

---
spec_id: SPEC-MED-001
version: 1.0.0
status: planned
created: 2026-02-07
updated: 2026-02-07
author: yeonijae
---

## 인수 조건 개요

복약 기록 시스템의 기능 검증을 위한 인수 조건을 Given-When-Then 형식으로 정의한다.

---

## 핵심 시나리오

### AC-001: 복약 일정 생성

**시나리오: 처방전 기반 복약 일정 생성**

```gherkin
Given 환자 "홍길동"에게 처방전이 발급되어 있고
  And 처방 기간이 7일이고
  And 하루 3회 복용으로 설정하려고 할 때
When 복약 일정 생성 폼에서
  And 시작일을 "2026-02-07"로 입력하고
  And 종료일을 "2026-02-13"로 입력하고
  And 복용 횟수를 3회로 선택하고
  And 복용 시간을 "08:00", "12:00", "18:00"으로 설정하고
  And 생성 버튼을 클릭하면
Then 복약 일정이 생성되고
  And 7일 * 3회 = 21개의 복약 슬롯이 자동 생성되고
  And 모든 슬롯의 초기 상태는 'pending'이고
  And 일정 목록에 새 일정이 표시된다
```

### AC-002: 복약 기록 입력

**시나리오: 정상 복약 기록 입력**

```gherkin
Given 오늘이 "2026-02-07"이고
  And 환자 "홍길동"의 복약 일정이 활성화되어 있고
  And 현재 시각이 "08:30"이고
  And 08:00 시간대의 슬롯이 활성화되어 있을 때
When 08:00 시간대의 슬롯을 클릭하고
  And 상태를 "복용완료(taken)"로 선택하면
Then 복약 기록이 저장되고
  And 해당 슬롯의 상태가 "taken"으로 변경되고
  And 녹색 체크 아이콘이 표시된다
```

**시나리오: 미복용 기록 입력**

```gherkin
Given 오늘이 "2026-02-07"이고
  And 환자 "홍길동"의 08:00 복약 시간이 지났고
  And 해당 슬롯이 아직 'pending' 상태일 때
When 해당 슬롯을 클릭하고
  And 상태를 "미복용(missed)"로 선택하고
  And 메모에 "외출 중이어서 복용하지 못함"을 입력하면
Then 복약 기록이 저장되고
  And 해당 슬롯의 상태가 "missed"로 변경되고
  And 빨간색 X 아이콘이 표시되고
  And 메모가 저장된다
```

### AC-003: 복약 시간 이전 입력 제한

**시나리오: 미래 시간대 입력 차단**

```gherkin
Given 현재 시각이 "10:00"이고
  And 환자 "홍길동"의 12:00 복약 슬롯이 있을 때
When 12:00 시간대의 슬롯을 클릭하면
Then 상태 선택 버튼이 비활성화되어 있고
  And "복약 시간이 아직 되지 않았습니다" 메시지가 표시된다
```

**시나리오: 조기 복용 예외 처리**

```gherkin
Given 현재 시각이 "10:00"이고
  And 환자 "홍길동"의 12:00 복약 슬롯이 있을 때
When 12:00 시간대의 슬롯을 클릭하고
  And "조기 복용으로 기록" 옵션을 선택하고
  And 확인 다이얼로그에서 "예"를 클릭하면
Then 상태 선택이 가능해지고
  And "복용완료(taken)"를 선택하면
  And 복약 기록이 저장되고
  And 자동으로 "조기 복용" 메모가 추가된다
```

### AC-004: 연속 미복용 경고

**시나리오: 3일 연속 미복용 경고 표시**

```gherkin
Given 환자 "홍길동"이 2026-02-05, 2026-02-06, 2026-02-07 3일 연속 모든 복약을 미복용(missed)했을 때
When 환자 목록 또는 환자 상세 화면을 조회하면
Then 해당 환자에게 경고 배지가 표시되고
  And 배지에 "복약 주의 필요" 문구가 표시되고
  And 배지 색상이 빨간색이다
```

### AC-005: 복약 이행률 계산

**시나리오: 일정 종료 후 이행률 표시**

```gherkin
Given 환자 "홍길동"의 복약 일정이 종료되었고
  And 총 21개의 슬롯 중
  And 18개가 "taken", 2개가 "missed", 1개가 "skipped"일 때
When 해당 일정의 통계를 조회하면
Then 이행률이 "85.7%" (18/21)로 표시되고
  And "복용완료: 18회" 라벨이 표시되고
  And "미복용: 2회" 라벨이 표시되고
  And "건너뜀: 1회" 라벨이 표시된다
```

### AC-006: 복약 기록 삭제 방지

**시나리오: 과거 기록 삭제 시도 차단**

```gherkin
Given 환자 "홍길동"의 2026-02-05 08:00 복약 기록이 "taken"으로 저장되어 있을 때
When 해당 기록의 삭제를 시도하면
Then "의료 기록은 삭제할 수 없습니다" 오류 메시지가 표시되고
  And 기록은 삭제되지 않고 유지된다
```

---

## 경계 조건 시나리오

### AC-007: 일정 수정 시 슬롯 처리

**시나리오: 종료일 연장**

```gherkin
Given 환자 "홍길동"의 복약 일정이 2026-02-07 ~ 2026-02-13(7일)이고
  And 현재 일정에 21개의 슬롯이 있을 때
When 종료일을 2026-02-16으로 연장하면
Then 새로운 3일분(9개) 슬롯이 추가되고
  And 기존 21개 슬롯은 그대로 유지되고
  And 총 30개의 슬롯이 된다
```

**시나리오: 종료일 단축**

```gherkin
Given 환자 "홍길동"의 복약 일정이 2026-02-07 ~ 2026-02-13(7일)이고
  And 2026-02-07 ~ 2026-02-09의 기록이 이미 입력되어 있을 때
When 종료일을 2026-02-10으로 단축하면
Then 2026-02-11 ~ 2026-02-13의 미래 슬롯이 제거되고
  And 2026-02-07 ~ 2026-02-09의 기존 기록은 유지되고
  And 총 12개의 슬롯이 된다 (4일 * 3회)
```

### AC-008: 중복 기록 방지

**시나리오: 동일 시간대 재입력**

```gherkin
Given 환자 "홍길동"의 2026-02-07 08:00 복약 기록이 "taken"으로 저장되어 있을 때
When 동일 슬롯에서 상태를 "missed"로 변경하면
Then 새로운 기록이 생성되지 않고
  And 기존 기록의 상태가 "missed"로 업데이트되고
  And 수정 이력이 보존된다
```

### AC-009: 대량 슬롯 생성

**시나리오: 365일 일정 생성 성능**

```gherkin
Given 환자 "홍길동"에게 장기 처방이 있을 때
When 365일, 하루 3회 복약 일정을 생성하면
Then 1,095개의 슬롯이 생성되고
  And 생성 완료까지 3초 이내이고
  And 슬롯 목록 로딩이 1초 이내이다
```

---

## UI/UX 시나리오

### AC-010: 오늘의 복약 현황 대시보드

**시나리오: 대시보드 위젯 표시**

```gherkin
Given 오늘 복약 일정이 있는 환자가 5명이고
  And 각 환자별로 3회 복약 예정일 때
When 대시보드를 조회하면
Then "오늘의 복약 현황" 위젯이 표시되고
  And 총 15개의 예정 복약이 표시되고
  And 완료/미완료 상태가 색상으로 구분되고
  And 환자 이름을 클릭하면 해당 환자의 복약 상세로 이동한다
```

### AC-011: 상태 아이콘 시각화

**시나리오: 상태별 아이콘 및 색상**

```gherkin
Given 복약 슬롯 목록이 표시될 때
When 각 슬롯의 상태를 확인하면
Then "taken" 상태는 녹색 체크 아이콘으로 표시되고
  And "missed" 상태는 빨간색 X 아이콘으로 표시되고
  And "skipped" 상태는 노란색 건너뛰기 아이콘으로 표시되고
  And "pending" 상태는 회색 빈 원 아이콘으로 표시된다
```

---

## 접근성 시나리오

### AC-012: 키보드 네비게이션

**시나리오: 키보드만으로 복약 기록 입력**

```gherkin
Given 복약 슬롯 목록이 표시될 때
When Tab 키로 슬롯 간 이동하고
  And Enter 키로 슬롯을 선택하고
  And 화살표 키로 상태를 선택하고
  And Enter 키로 확정하면
Then 마우스 없이 복약 기록이 입력되고
  And 포커스 표시가 명확하게 보인다
```

### AC-013: 스크린 리더 호환

**시나리오: 스크린 리더로 복약 현황 확인**

```gherkin
Given 스크린 리더가 활성화되어 있을 때
When 복약 슬롯에 포커스하면
Then "2026년 2월 7일 오전 8시 복약, 상태: 복용완료"와 같이 읽어준다
```

---

## 품질 게이트

### 기능 완료 기준

- [ ] 모든 핵심 시나리오 (AC-001 ~ AC-006) 통과
- [ ] 모든 경계 조건 시나리오 (AC-007 ~ AC-009) 통과
- [ ] UI/UX 시나리오 (AC-010 ~ AC-011) 통과

### 코드 품질 기준

- [ ] TypeScript 컴파일 오류 0개
- [ ] ESLint 경고 0개
- [ ] 단위 테스트 커버리지 80% 이상

### 성능 기준

- [ ] 복약 기록 조회 응답시간 < 500ms
- [ ] 상태 업데이트 응답시간 < 100ms
- [ ] 대량 슬롯(1,000개 이상) 렌더링 시 프레임 드롭 없음

### 접근성 기준

- [ ] 키보드 네비게이션 완전 지원
- [ ] WCAG 2.1 AA 수준 준수
- [ ] 색상 대비 4.5:1 이상

---

## 테스트 시나리오 매핑

| 인수 조건 | 테스트 유형 | 우선순위 |
|-----------|-------------|----------|
| AC-001 | 통합 테스트 | High |
| AC-002 | 단위 + 통합 | High |
| AC-003 | 단위 테스트 | High |
| AC-004 | 단위 테스트 | Medium |
| AC-005 | 단위 테스트 | Medium |
| AC-006 | 단위 테스트 | High |
| AC-007 | 통합 테스트 | Medium |
| AC-008 | 단위 테스트 | High |
| AC-009 | 성능 테스트 | Low |
| AC-010 | E2E 테스트 | Medium |
| AC-011 | 시각적 회귀 테스트 | Low |
| AC-012 | 수동 테스트 | Medium |
| AC-013 | 수동 테스트 | Low |

---

## 연관 문서

- spec.md - 요구사항 정의
- plan.md - 구현 계획

---

*문서 버전: 1.0.0*
*최종 수정: 2026-02-07*
