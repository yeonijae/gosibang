# SPEC-MED-003: 복약 알림 시스템 - 인수 조건

---
spec_id: SPEC-MED-003
version: 1.0.0
status: planned
created: 2026-02-07
updated: 2026-02-07
author: yeonijae
---

## 인수 조건 개요

복약 알림 시스템의 기능 검증을 위한 인수 조건을 Given-When-Then 형식으로 정의한다.

---

## 핵심 시나리오

### AC-001: 복약 시간 사전 알림

**시나리오: 복약 5분 전 데스크탑 알림 발송**

```gherkin
Given 환자 "홍길동"의 복약 일정이 08:00에 예정되어 있고
  And 현재 시각이 07:55이고
  And 알림 설정에서 데스크탑 알림이 활성화되어 있고
  And 사전 알림 시간이 5분으로 설정되어 있을 때
When 스케줄러가 1분 주기로 체크하면
Then 데스크탑 알림이 발송되고
  And 알림 제목이 "홍길동님 복약 시간"이고
  And 알림 본문이 "08:00에 복약 예정입니다"이고
  And 인앱 알림 센터에 해당 알림이 저장된다
```

### AC-002: 인앱 토스트 알림 (포그라운드)

**시나리오: 앱 사용 중 토스트 알림 표시**

```gherkin
Given 애플리케이션이 포그라운드에서 실행 중이고
  And 환자 "이순신"의 복약 시간이 도래했을 때
When 알림이 발생하면
Then 화면 우상단에 토스트 알림이 표시되고
  And 5초 후 자동으로 사라지고
  And 토스트 클릭 시 해당 환자의 복약 상세로 이동한다
```

### AC-003: 미복용 알림

**시나리오: 복약 시간 30분 경과 후 알림**

```gherkin
Given 환자 "김유신"의 08:00 복약이 예정되어 있고
  And 현재 시각이 08:30이고
  And 해당 시간대의 복약 기록이 입력되지 않았을 때
When 스케줄러가 미복용 체크를 수행하면
Then 미복용 알림이 발송되고
  And 알림 제목이 "복약 확인 필요"이고
  And 알림 본문이 "김유신님의 08:00 복약이 기록되지 않았습니다"이고
  And 알림 우선순위가 "high"이다
```

### AC-004: 일일 복약 요약 알림

**시나리오: 매일 09:00 일일 요약 발송**

```gherkin
Given 오늘 예정된 복약이 총 15건이고
  And 현재 시각이 09:00이고
  And 일일 요약 시간이 09:00으로 설정되어 있을 때
When 스케줄러가 일일 요약 체크를 수행하면
Then 일일 요약 알림이 발송되고
  And 알림 제목이 "오늘의 복약 현황"이고
  And 알림 본문에 "오늘 예정된 복약: 15건"이 포함되고
  And 알림 클릭 시 대시보드로 이동한다
```

### AC-005: 연속 미복용 긴급 알림

**시나리오: 3일 연속 미복용 시 긴급 알림**

```gherkin
Given 환자 "강감찬"이 2026-02-05, 2026-02-06, 2026-02-07 3일 연속 모든 복약을 미복용했을 때
When 시스템이 연속 미복용을 감지하면
Then 긴급 알림이 발송되고
  And 알림 우선순위가 "critical"이고
  And 알림 제목이 "긴급: 복약 관리 필요"이고
  And 인앱 알림 센터에 고정 표시되고
  And 방해 금지 시간이어도 알림이 발송된다 (설정에 따라)
```

### AC-006: 알림 센터 열기

**시나리오: 사이드바에서 알림 센터 열기**

```gherkin
Given 읽지 않은 알림이 5개 있을 때
When 사이드바의 알림 아이콘을 클릭하면
Then 알림 센터 패널이 열리고
  And 알림 목록이 최신순으로 표시되고
  And 읽지 않은 알림에 표시(뱃지)가 있고
  And 상단에 "전체 읽음" 버튼이 있다
```

### AC-007: 알림 읽음 처리

**시나리오: 개별 알림 읽음 처리**

```gherkin
Given 알림 센터가 열려 있고
  And 읽지 않은 알림 "홍길동님 복약 시간"이 있을 때
When 해당 알림을 클릭하면
Then 알림이 읽음 처리되고
  And 알림의 읽음 표시가 변경되고
  And 사이드바의 읽지 않은 알림 배지 숫자가 감소하고
  And 해당 환자의 복약 상세 화면으로 이동한다
```

### AC-008: 전체 알림 읽음 처리

**시나리오: 모든 알림 한 번에 읽음 처리**

```gherkin
Given 알림 센터에 읽지 않은 알림이 10개 있을 때
When "전체 읽음" 버튼을 클릭하면
Then 모든 알림이 읽음 처리되고
  And 사이드바 배지가 사라지고
  And 알림 목록의 모든 항목이 읽음 상태로 표시된다
```

---

## 알림 설정 시나리오

### AC-009: 글로벌 알림 비활성화

**시나리오: 전체 알림 끄기**

```gherkin
Given 알림 설정 화면에서
When 전체 알림 토글을 비활성화하면
Then 모든 알림 발송이 중지되고
  And 스케줄러는 계속 동작하지만 알림은 발송하지 않고
  And 설정 저장 확인 메시지가 표시된다
```

### AC-010: 채널별 알림 설정

**시나리오: 데스크탑 알림만 비활성화**

```gherkin
Given 알림 설정 화면에서
  And 전체 알림은 활성화되어 있을 때
When 데스크탑 알림 토글만 비활성화하면
Then 데스크탑 알림은 발송되지 않고
  And 인앱 토스트 알림은 계속 표시되고
  And 알림 센터에는 알림이 계속 저장된다
```

### AC-011: 사전 알림 시간 변경

**시나리오: 사전 알림 시간을 10분으로 변경**

```gherkin
Given 알림 설정 화면에서
  And 현재 사전 알림 시간이 5분으로 설정되어 있을 때
When 사전 알림 시간을 10분으로 변경하고 저장하면
Then 설정이 즉시 적용되고
  And 다음 알림부터 10분 전에 발송되고
  And 기존 예약된 알림이 새 시간에 맞게 조정된다
```

### AC-012: 방해 금지 시간 설정

**시나리오: 야간 시간대 알림 차단**

```gherkin
Given 알림 설정 화면에서
  And 방해 금지 시작 시간이 22:00이고
  And 방해 금지 종료 시간이 07:00으로 설정되어 있을 때
When 현재 시각이 23:00이고 알림이 발생하면
Then 데스크탑 알림은 발송되지 않고
  And 사운드는 재생되지 않고
  And 인앱 알림 센터에만 저장된다
```

### AC-013: 긴급 알림 방해 금지 예외

**시나리오: 방해 금지 중에도 긴급 알림 허용**

```gherkin
Given 방해 금지 시간대 (23:00)이고
  And 방해 금지 중 긴급 알림 허용이 활성화되어 있고
  And 환자 "홍길동"이 3일 연속 미복용 상태일 때
When 긴급 알림이 발생하면
Then 데스크탑 알림이 발송되고
  And 알림에 "긴급" 표시가 포함되고
  And 설정에 따라 사운드도 재생된다
```

---

## 일정별 알림 설정 시나리오

### AC-014: 일정별 알림 비활성화

**시나리오: 특정 환자의 알림만 끄기**

```gherkin
Given 환자 "홍길동"의 복약 일정 상세 화면에서
When 해당 일정의 알림을 비활성화하면
Then 해당 일정에 대한 알림만 중지되고
  And 다른 환자의 알림은 정상 발송되고
  And 일정 목록에 알림 비활성화 아이콘이 표시된다
```

### AC-015: 일정별 사전 알림 시간 커스터마이징

**시나리오: VIP 환자에게 30분 전 알림**

```gherkin
Given 환자 "이순신"의 복약 일정 상세 화면에서
  And 글로벌 사전 알림 시간이 5분으로 설정되어 있을 때
When 해당 일정의 사전 알림 시간을 30분으로 설정하면
Then 이순신님의 알림만 30분 전에 발송되고
  And 다른 환자는 기존 5분 전에 발송되고
  And 일정 상세에 커스텀 설정 표시가 된다
```

---

## 사운드 시나리오

### AC-016: 사운드 알림 재생

**시나리오: 알림 발생 시 사운드 재생**

```gherkin
Given 사운드 알림이 활성화되어 있고
  And 볼륨이 50%로 설정되어 있을 때
When 복약 알림이 발생하면
Then 설정된 사운드 프리셋이 재생되고
  And 볼륨이 50%로 재생된다
```

### AC-017: 사운드 프리셋 변경

**시나리오: 알림음 변경**

```gherkin
Given 알림 설정 화면에서
  And 현재 사운드 프리셋이 "기본"으로 설정되어 있을 때
When 사운드 프리셋을 "차임벨"로 변경하면
Then 미리듣기 사운드가 재생되고
  And 저장 후 다음 알림부터 새 사운드가 재생된다
```

---

## 웹 클라이언트 시나리오

### AC-018: 브라우저 알림 권한 요청

**시나리오: 웹 클라이언트 첫 방문 시 권한 요청**

```gherkin
Given 웹 클라이언트에 처음 접속했을 때
When 복약 관리 페이지에 진입하면
Then 브라우저 알림 권한 요청 다이얼로그가 표시되고
  And "알림을 허용하면 복약 시간을 알려드립니다" 안내 문구가 표시되고
  And "허용" / "나중에" 버튼이 있다
```

### AC-019: 브라우저 알림 권한 거부 시 fallback

**시나리오: 권한 거부 후 인앱 알림만 사용**

```gherkin
Given 웹 클라이언트에서 브라우저 알림 권한을 거부했을 때
When 복약 알림이 발생하면
Then 브라우저 알림은 시도하지 않고
  And 인앱 토스트 알림만 표시되고
  And 알림 센터에 알림이 저장된다
```

### AC-020: 웹 클라이언트 알림 수신

**시나리오: 폴링으로 신규 알림 감지**

```gherkin
Given 웹 클라이언트가 실행 중이고
  And 알림 폴링 간격이 30초로 설정되어 있을 때
When 서버에서 새 알림이 생성되면
Then 30초 이내에 웹 클라이언트에서 알림을 수신하고
  And 브라우저 알림(권한 허용 시) 또는 인앱 토스트가 표시된다
```

---

## 알림 이력 시나리오

### AC-021: 알림 이력 조회

**시나리오: 지난 알림 목록 확인**

```gherkin
Given 알림 센터가 열려 있을 때
When 스크롤하여 이전 알림을 조회하면
Then 최근 30일간의 알림이 시간순으로 표시되고
  And 날짜별로 그룹핑되어 표시되고
  And 읽음/미읽음 상태가 구분된다
```

### AC-022: 알림 이력 필터링

**시나리오: 미복용 알림만 필터**

```gherkin
Given 알림 센터에서 필터 드롭다운을 열 때
When "미복용" 유형을 선택하면
Then 미복용 알림(medication_missed)만 표시되고
  And 필터가 적용되었음을 나타내는 표시가 있고
  And "필터 초기화" 버튼이 표시된다
```

---

## 중복 방지 시나리오

### AC-023: 동일 시간대 중복 알림 방지

**시나리오: 같은 복약 시간에 대해 1회만 알림**

```gherkin
Given 환자 "홍길동"의 08:00 복약에 대해 이미 알림이 발송되었을 때
When 스케줄러가 다음 주기에 다시 체크하면
Then 동일 복약 시간에 대해 중복 알림이 발송되지 않고
  And 알림 센터에 동일 알림이 추가되지 않는다
```

### AC-024: 이미 완료된 복약에 대한 알림 방지

**시나리오: 복약 완료 후 미복용 알림 발송 안 함**

```gherkin
Given 환자 "홍길동"의 08:00 복약이 08:05에 "taken"으로 기록되었을 때
When 스케줄러가 08:30에 미복용 체크를 수행하면
Then 해당 시간대에 대해 미복용 알림이 발송되지 않는다
```

---

## 프라이버시 시나리오

### AC-025: 환자명 마스킹

**시나리오: 데스크탑 알림에서 환자명 마스킹**

```gherkin
Given 알림 설정에서 환자명 마스킹이 활성화되어 있을 때
When 환자 "홍길동"에 대한 데스크탑 알림이 발송되면
Then 알림 제목에 "홍*동님 복약 시간"으로 표시되고
  And 인앱 알림에서는 전체 이름이 표시된다
```

---

## 품질 게이트

### 기능 완료 기준

- [ ] 모든 핵심 시나리오 (AC-001 ~ AC-008) 통과
- [ ] 모든 알림 설정 시나리오 (AC-009 ~ AC-013) 통과
- [ ] 일정별 알림 설정 시나리오 (AC-014 ~ AC-015) 통과
- [ ] 중복 방지 시나리오 (AC-023 ~ AC-024) 통과

### 코드 품질 기준

- [ ] TypeScript 컴파일 오류 0개
- [ ] Rust clippy 경고 0개
- [ ] ESLint 경고 0개
- [ ] 알림 관련 함수 단위 테스트 작성

### 성능 기준

- [ ] 스케줄러 1분 주기 정확도 오차 < 5초
- [ ] 알림 발송 지연 < 30초
- [ ] 알림 목록 로딩 < 500ms
- [ ] 스케줄러 메모리 추가 사용 < 10MB

### 접근성 기준

- [ ] 토스트 알림 스크린 리더 호환 (aria-live)
- [ ] 키보드로 알림 센터 탐색 가능
- [ ] 우선순위 아이콘 + 색상 함께 사용

---

## 테스트 시나리오 매핑

| 인수 조건 | 테스트 유형 | 우선순위 |
|-----------|-------------|----------|
| AC-001 | 통합 테스트 | High |
| AC-002 | 단위 + 통합 | High |
| AC-003 | 통합 테스트 | High |
| AC-004 | 통합 테스트 | Medium |
| AC-005 | 통합 테스트 | High |
| AC-006 | E2E 테스트 | High |
| AC-007 | 단위 테스트 | High |
| AC-008 | 단위 테스트 | Medium |
| AC-009 | 단위 테스트 | High |
| AC-010 | 단위 테스트 | Medium |
| AC-011 | 통합 테스트 | Medium |
| AC-012 | 통합 테스트 | Medium |
| AC-013 | 통합 테스트 | Medium |
| AC-014 | 단위 테스트 | Medium |
| AC-015 | 통합 테스트 | Low |
| AC-016 | 수동 테스트 | Low |
| AC-017 | 수동 테스트 | Low |
| AC-018 | E2E 테스트 | Low |
| AC-019 | E2E 테스트 | Low |
| AC-020 | 통합 테스트 | Low |
| AC-021 | E2E 테스트 | Medium |
| AC-022 | E2E 테스트 | Low |
| AC-023 | 단위 테스트 | High |
| AC-024 | 단위 테스트 | High |
| AC-025 | 단위 테스트 | Low |

---

## 연관 문서

- spec.md - 요구사항 정의
- plan.md - 구현 계획

---

*문서 버전: 1.0.0*
*최종 수정: 2026-02-07*
